
<style type="text/css" media="screen">
	#flash { 
		display:none; 
		color:#0000;
		background-color:yellow;
	}
	
	.form-group {
		margin-bottom: 2px;
	}
	.tcm-form-control {
		width: 60%;
		padding-left: 4px;
	}
	.event-repetition {
		background-color:#f6f6f6;
	}
</style>
<script type="text/javascript" charset="utf-8">
	$(document).ready(function() {
		//alert('ready');
		// $(".datepickerField").datepicker();

		$('.event-form').submit(function() {  
		    // alert('handle: ' + myHandleToMainWindow);
		    var valuesToSubmit = $(this).serialize();
		    $.ajax({
		        url: $(this).attr('action'), //sumbits it to the given url of the form
		        data: valuesToSubmit,
				type: "POST",
		        dataType: "JSON" // you want a difference between normal and ajax-calls, and json is standard
		    }).success(function(json){
				$("#flash").show();
				$("#flash").effect("fade", {}, 3500);
				$('#saved_event_result_as_json').val(JSON.stringify(json));
		    });
		
		    return false; // prevents normal behaviour
		});
		
		$(document).click(function(e) {
			if(e.target.id=="popovercloseid" ) {
				hideThePopoverThatContainsMe()
			}
		});
		
		function hideThePopoverThatContainsMe() {
			var id = '#event-id-<%= @event.id %>';
			var x = $(id);
			console.log('mmm bueno (' + id + ') ' + x);
			x.popover('hide');                
		}
	});
</script>

<%= form_for @event, :html => { :class => 'form-horizontal event-form', :role => "form" } do |f| %>
  <% if @event.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@event.errors.count, "error") %> prohibited this event from being saved:</h2>

      <ul>
      <% @event.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
	
  <%= hidden_field_tag :saved_event_result_as_json %>

  <div class="form-group">
	<%= f.label :description, :class => "col-sm-2 control-label" %>
	<div class="col-sm-10">
		<%= f.text_field :description, :placeholder => "New description of activity", :class => "tcm-form-control" %>
	</div>
  </div>
  <div class="form-group">
    <%= f.label :starts_at, :class => "col-sm-2 control-label" %>
	<div class="col-sm-10">
		<%= f.text_field :starts_at, :placeholder => "Date activity starts", :class => "datepickerField tcm-form-control" %>
	</div>
  </div>
  <div class="form-group">
    <%= f.label :ends_at, :class => "col-sm-2 control-label" %>
	<div class="col-sm-10">
		<%= f.text_field :ends_at, :placeholder => "Date activity ends", :class => "datepickerField tcm-form-control" %>
	</div>
  </div>
  <div class="form-group">
    <%= f.label :campaign, :class => "col-sm-2 control-label"  %>
	<div class="col-sm-10">
		<%= f.collection_select :campaign_id, Campaign.order(:description), :id, :description, {:prompt => "--  Select Campaign --"}, {:class => "tcm-form-control"} %>	
	</div>
	
  </div>
  <div class="form-group">
    <%= f.label :category_id, :class => "col-sm-2 control-label"  %>
	<div class="col-sm-10">
		<%= f.collection_select :category_id, Category.order(:description), :id, :description, {:prompt => "--  Select Category --"}, {:class => "tcm-form-control"} %>	
	</div>
  </div>
  
  
  <div class="event-repetition">
	  <div class="form-group">
	    <%= f.label "Repetition Info", :class => "col-sm-2 control-label" %>
		<div class="col-sm-10">
			<%= f.text_field :repetition_type, :placeholder => "Repetition Info", :class => "tcm-form-control" %>
		</div>
	  </div>
	  <div class="form-group">
	    <%= f.label "Repetition Frequency", :class => "col-sm-2 control-label" %>
		<div class="col-sm-10">
			<%= f.text_field :repetition_frequency, :placeholder => "Repetition Frequency", :class => "tcm-form-control" %>
		</div>
	  </div>
	  <div class="form-group">
	    <%= f.label "Repetition Options", :class => "col-sm-2 control-label" %>
		<div class="col-sm-10">
			<%= f.text_field :repetition_options, :placeholder => "Repetition Options", :class => "tcm-form-control" %>
		</div>
	  </div>
	  
	  <div class="form-group">
		<%= f.label "Occurs on", :class => "col-sm-2 control-label" %>
		<div class="col-sm-offset-2 col-sm-10">
				<label class="checkbox inline">
					<%= f.check_box :on_sunday %> Sun
				</label>

				<label class="checkbox inline">
					<%= f.check_box :on_monday %> Mon
				</label>

				<label class="checkbox inline">
					<%= f.check_box :on_tuesday %> Tue
				</label>

				<label class="checkbox inline">
					<%= f.check_box :on_wednesday %> Wed
				</label>

				<label class="checkbox inline">
					<%= f.check_box :on_thursday %> Thu
				</label>

				<label class="checkbox inline">
					<%= f.check_box :on_friday %> Fri
				</label>

				<label class="checkbox inline">
					<%= f.check_box :on_saturday %> Sat
				</label>
		</div>
	  </div>

  </div>


  <div class="actions">
    <%= f.submit %> <span id="flash">Your changes have been saved!</span>
  </div>
<% end %>
